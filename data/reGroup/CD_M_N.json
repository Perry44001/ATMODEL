[
    {
        "instruction": "使用plotssp画声速剖面报错，应该如何解决？\n索引超出数组元素的数目(0)。\n出错 read bell(line 28)\nBeam. RunType =[ Beam. RunType( nchars(1)+1:nchars(2)-1)blanks(5-(nchars(2)- nchars(1)))]\n出错 plotssp(line 11)\nread env( envfil,'BELLHOP')",
        "input": "",
        "output": "因为env有两种格式，一个是KRAKEN的，一个是BELLHOP的，用read_env这个函数就需要注意一下是kraken的还是bellhop的，如果您绘制的是KRAKEN的env，请将代码改为read_env( envfil,'KRAKEN')，反之同理"
    },
    {
        "instruction": "下面代码报错如何接解决？\nfilename='MunkK';\n[ Modes ]=read_modes(filename, 0);\n报错索引超出数组元素的数目(5)\n出错 read_modes(line 18)\nswitch filename(1:6)",
        "input": "",
        "output": "可能是文件名没加没有.mod后缀，请将代码改为\nfilename='MunkK';\n[ Modes ]=read_modes([filename '.mod'], 0);"
    },
    {
        "instruction": "请教您一下，请问如何利用kraken只选择两个特定的简正波做仿真，例如只选择第二号和第十号简正波来仿真？",
        "input": "",
        "output": "您可以借鉴field.m的代码计算声压，在field.m中使用read_modes读取出来第二号和第十号简正波，计算pressure。"
    },
    {
        "instruction": "请问运行bellhopM.m遇到过这个问题么，reflect.m中函数或变量 'rInt' 无法识别？",
        "input": "",
        "output": "bellhopM.m代码太久没有维护，反射系数文件读取代码缺失，因此变量 'rInt' 无法识别。"
    },
    {
        "instruction": "这个报错是什么原因？plotbty3d munk3d\n未定义函数或变量plotbty3d'",
        "input": "",
        "output": "在munk3d后面加上.bty试试，代码改为\nplotbdry3d munk3d.bty。"
    },
    {
        "instruction": "ram如何设置多层海底？",
        "input": "",
        "output": "可以这样设置，在两层中间加一个很小的中间过渡层\n-1-1\n0.0 1565.0\n29.99 1565.0\n30.0 1600.0"
    },
    {
        "instruction": "请问env中的ssp参数\n28 1800.0 0.0 1.84 0.3 0.0/\n代表什么意思？",
        "input": "",
        "output": "底部深度，底部纵波速度，底部横波速度，底部密度 ，底部纵波衰减系数，底部横波衰减系数。"
    },
    {
        "instruction": "请问一下，在运行bellhop时出现过这样的问题应该如何解决？At line 905 of file sspMod.f90(unit =5, file = fangzhen.env)\nFortran runtime error: Bad real number in item l of list input",
        "input": "",
        "output": "出现这样的提示可能是声速剖面设置的问题，定义的海深的ssp给出的海深不一致。"
    },
    {
        "instruction": "想请教一个问题，如果在ram里设置沉积层的话，具体应该怎么实现呢？按照我的理解在ram里设置似乎与kraken相同水文环境的结果不太一致。",
        "input": "",
        "output": "想要在ram中设置沉积层或者说设置多层海底，可以通过设置多个比较浅的中间层，比如可以设置0 1600 \n 10 1600\n 10.1 1700的方式，在10到10.1m处加入一层中间层。"
    },
    {
        "instruction": "请问用read_arrivals_asc读出来的delay和SrcAngle是本征声线的时延和对应掠射角吗？",
        "input": "",
        "output": "是的，read_arrivals_asc.m是声学工具箱的read函数，读取bellhop生成的到达结构.arr文件，其中delay和SrcAngle是读取到的结构体Arr的成员，delay代表到达结构（本征声线）的时延，SrcAngle代表到达结构（本征声线）的发射（声源）处掠射角。"
    },
    {
        "instruction": "请问bellhop3d一直报错这个是什么情况?\nGenerated by program or subroutine:Hexahedral\nray is outside the box where the soudspeed is defined",
        "input": "",
        "output": "使用bellhop3d并定义了三维的声速剖面，需要使3维声速剖面的x和y维度大于bellhop3d计算的声场大小，因此最好定义一个正方形区域，且其正负范围略大于xBox和yBox的大小。"
    },
    {
        "instruction": "用bellhop跑环境文件，但是没有.arr文件生成是什么原因？",
        "input": "",
        "output": "如果您的路径中存在.env文件（bellhop环境文件），并且文件格式没有问题的话，请检查.env的runtype，并把env中的runtype改成'A'，再次运行bellhop就能够生成.arr（到达结构文件）文件。"
    },
    {
        "instruction": "读shd数据时，Ntheta 和Nsz是什么意思啊？",
        "input": "",
        "output": "Nsz是声源个数，Ntheta为水平发射角度。"
    },
    {
        "instruction": "运行bellhop报错应该如何解决？\n*** FATAL ERROR ***\nGenerated by program or subroutine: ReadEnvironmentMesh is too coarse\nray is outside the box where the soundspeed is defined",
        "input": "",
        "output": "声线超过了声速剖面的定义范围，建议将声速剖面的距离范围或者x,y（3d bellhop）范围增大，即将边界范围扩大。"
    },
    {
        "instruction": "为什么存在BELLHOP计算的射线碰到海底时没有反射回来的情况？",
        "input": "",
        "output": "请检查Box边界设置那里深度z是不是就是设置的声速剖面的最深深度，如果是，请增大Box.z的大小，只要大于声速剖面最大深度就行。"
    },
    {
        "instruction": "请问bellhop3d的.env环境文件里面这theta和beta是设置的哪个角的角度？",
        "input": "",
        "output": "beta是出图的角度，theta是计算的角度决定了最后.shd的维度。"
    },
    {
        "instruction": "bellhop.exe not found in your Matlab path应该如何解决？",
        "input": "",
        "output": "这个问题出现在声学工具箱（Acoustic Toolbox）加载路径的错误。下载声学工具箱后，若想在matlab上调用它，需要在matlab主页上方点击“设置路径”-“添加并包含子文件夹”，把工具箱文件添加进去。"
    },
    {
        "instruction": "ram.exe not found in your Matlab path应该如何解决？",
        "input": "",
        "output": "这个问题出现在声学工具箱（Acoustic Toolbox）加载路径的错误。下载声学工具箱后，若想在matlab上调用它，需要在matlab主页上方点击“设置路径”-“添加并包含子文件夹”，把工具箱文件添加进去。"
    },
    {
        "instruction": "bellhop3D.exe not found in your Matlab path应该如何解决？",
        "input": "",
        "output": "这个问题出现在声学工具箱（Acoustic Toolbox）加载路径的错误。下载声学工具箱后，若想在matlab上调用它，需要在matlab主页上方点击“设置路径”-“添加并包含子文件夹”，把工具箱文件添加进去。"
    },
    {
        "instruction": "kraken.exe not found in your Matlab path应该如何解决？",
        "input": "",
        "output": "这个问题出现在声学工具箱（Acoustic Toolbox）加载路径的错误。下载声学工具箱后，若想在matlab上调用它，需要在matlab主页上方点击“设置路径”-“添加并包含子文件夹”，把工具箱文件添加进去。"
    },
    {
        "instruction": "bellhop中的.env里声剖需要比水深更深嘛？",
        "input": "",
        "output": "若存在地形文件（.bty）文件，则在bellhop环境文件.env中定义声速剖面深度值，必须得至少大于bty中最深的值。若不存在地形文件（.bty）文件，则在bellhop环境文件.env中定义声速剖面深度值，最好大于.env定义的海深。"
    },
    {
        "instruction": "bellhop计算声场输入的是一个什么信号？",
        "input": "",
        "output": "bellhop计算的是一个频点上的声场，在频域上，一个频点的信号，相当于时域上，一个无限长的单频信号，信号形式可以表示为y=sin(2\\pi f t)。"
    },
    {
        "instruction": "bellhop的表面形状.ati文件的两列是什么意思？",
        "input": "",
        "output": "bellhop的表面形状.ati文件的两列分别代表距离（km）和深度（m）。"
    },
    {
        "instruction": "bellhop的海底地形.bty文件的两列是什么意思？",
        "input": "",
        "output": "bellhop的海底地形.bty文件的两列分别代表距离（km）和深度（m）。"
    },
    {
        "instruction": "请问输出传播损失图形时能把深度调整到5km吗",
        "input": "",
        "output": "如果要把在传播损失图形时能把深度调整到5km，可以在plotshd画图语句后加入代码\n ylim([0 5000]) \n ylim是一个限制y轴坐标范围的函数，其中0 5000代表y轴显示的上下限。"
    },
    {
        "instruction": "介绍一下.ati文件，",
        "input": "",
        "output": "bellhop的表面形状.ati文件和海底地形文件.bty的格式一样，第一行是插值方式，比如常用的'L'代表分段线性，'C'代表分段曲线，第二行说明你有多少行数据，接下来是距离（km）和深度（m）的表格。"
    },
    {
        "instruction": "在matlab命令行输入代码kraken MunKK; 请问这是定义一个变量还是在干什么",
        "input": "请解释代码",
        "output": "这句maltab命令的意思是调用kraken.exe运行MunkK.env的环境文件，其中\"kraken\"是声学工具箱调用kraken.exe的函数kraken.m，\"MunKK\"是调用的环境文件名。"
    },
    {
        "instruction": "plotssp, plotbty, plotbrc, etc.  这是acoustic tool自定义的函数吗？ 然后调用这些函数进行画图",
        "input": "解释代码",
        "output": "是的，这些都是声学工具箱acoustic tool自定义的函数，plotssp 是绘制.env的声速剖面函数，plotbty是绘制.bty地形的函数，plotbrc是绘制.brc反射系数的函数，还有类似的画传播损失函数plotshd、plottlr、plottld等。"
    },
    {
        "instruction": "plotshd MunKK.shd.mat，plotshd是matlab提供的函数吗",
        "input": "解释代码",
        "output": "plotshd是声学工具箱acoustic tool自定义的函数，用于读取.shd.mat或者.shd（声压文件）并绘传播损失图的函数，传播损失公式为$TL = -20log10(pres)$可以绘制二维（随着距离和深度变化）的传播损失图，也可以绘制一维（随着距离或深度变化）的传播损失图。"
    },
    {
        "instruction": "画传播损失图用哪个函数？",
        "input": "",
        "output": "plotshd filename 比如代码\nplotshd MunKK.shd。"
    },
    {
        "instruction": "如何使用声学工具箱的函数读出简正波的波数？",
        "input": "",
        "output": "使用read_modes函数可以读取波数等参数，但仅限于kraken运行成功，存在.mod文件（简正波模型才有波数的概念），代码\n[ Modes ] = read_modes( filename, freq );\n读取成功后Modes.k即为水平波数。"
    },
    {
        "instruction": "读取声压时报错如何解决\n[ PlotTitle, PlotType, freqVec,atten, Pos, pressure ]=read_shd('MunkB_Coh');\n调用\"read shd\"时，未对输出参数\"PlotTitle\"(可能还包括其他参数)赋值。",
        "input": "",
        "output": "使用read_shd读取声压时，需要加入文件后缀，因此代码可以改为：\n[ PlotTitle, PlotType, freqVec,atten, Pos, pressure ]=read_shd('MunkB_Coh.shd');。"
    },
    {
        "instruction": "如何从.csv文件导入声速剖面到.env中？",
        "input": "",
        "output": "可以把csv读出来后，使用fprintf函数写入txt文件，再复制到.env环境文件当中。"
    },
    {
        "instruction": "运行bellhop时报错怎么解决\nGenerated by program or subroutine: READIN\nUnknown bottom option letter in second position",
        "input": "",
        "output": "bottom选项的第二个位置有问题，READIN这个函数无法识别，请检查bottom option，可能你没设置成他预设的几个选项之一，就报错了，比如Fortran程序预设你只能输入A、B、C中的一个，你输入的是D，就会报这种错误"
    },
    {
        "instruction": "Generated by program or subroutine: READIN\nUnknown bottom option letter in second position",
        "input": "",
        "output": "bottom选项的第二个位置有问题，READIN这个函数，请检查bottom option"
    },
    {
        "instruction": "使用简正波(kraken)计算声场，kraken的本征函数怎样输出呢",
        "input": "",
        "output": "可以read_modes读取，\nModes = read modes bin( filename, freq, modes );"
    },
    {
        "instruction": "plottld和plottlr是怎么用的？",
        "input": "",
        "output": "生成SHD文件后，用plottlr或者plottld指令画图\n1. plottld\nplottld( varargin ) 画某一距离上的传播损失，一般的调用方法为plottld( filename, rrt )，rrt的单位是km，注意rrt一定要在阵列的距离范围内，多个声源存在时，只画第一个声源的。（注意加figure，否则容易覆盖原图）\n2. plottlr\nplottlr( varargin ) 画某一距离上的传播损失，一般的调用方法为plottlr( filename, rdt )，rdt的单位是m，注意rdt一定要在阵列的深度范围内，多个声源存在时，只画第一个声源的。"
    },
    {
        "instruction": "plotshd只画第一个声源深度的传播损失信息，应该如何画其他声源的传播损失？",
        "input": "",
        "output": "可以的，在matlab命令行中输入open plotshd，打开plotshd函数，然后改一下plotshd里面的isd就行"
    },
    {
        "instruction": "请问如何在循环内部改变env的频率？",
        "input": "",
        "output": "有两种方式，如果您可以配合read_env和write_env两个函数，在循环中改变freq。\nmodel = 'BELLHOP';\n[ TitleEnv, freq, SSP, Bdry, Pos, Beam, cInt, RMax, fid ] = read_env( ARRFIL, model );\nfreq = 您想要的频率;\nwrite_env(ARRFIL, model, TitleEnv, freq, SSP, Bdry, Pos, Beam, [], RMax);\n另外，您可以使用，changeenv(f,filename)来改变环境文件的频率，其中f为频率，filename为环境文件名（不带后缀），代码链接：https://gitee.com/open-ocean/SourceLocalization-qianpeng/blob/master/BELLHOPQ&A/01BasicQ&A/02PltColor/changeenv.m"
    },
    {
        "instruction": "在cmd中运行ram的时候，报文件不存在的错误怎么办",
        "input": "",
        "output": "没打开in文件吧，看看in文件路径对不对，在cmd中运行原始版本的ram.exe，只能处理“ram.in”这个文件名的文件，需要现在cmd中cd到ram.in所在的当前文件；群主修改的那版可以输入文件名和文件路径了，需要在命令行输入.\\ram .\\mypath\\ram.in"
    },
    {
        "instruction": "怎么画出海山.bty的轮廓？",
        "input": "",
        "output": "使用plotbty可以绘制海底山的轮廓，如果您想要在声传播损失图中加入海底地形轮廓，可以使用以下代码\nfigure;\nplotshd {filename}.shd\nplotbty {filename}.bty\n请注意上面的代码中，{filename}为您的环境文件名。"
    },
    {
        "instruction": "请问如何将两个声速剖面放在一张图上面",
        "input": "",
        "output": "ssp画图的函数里，可能有个figure，删掉就行了，命令行输入open plotssp，删除或者注释画图plot代码前面的figure，并在绘制声速剖面的中间加入hold on语句。另外，您也可以直接使用plot函数，把两个ssp的数据读进来，使用plot函数绘制声速剖面。"
    },
    {
        "instruction": "使用的vs+fortran编译at2022,编译出来的可执行文件在执行plotshd结果都是错误的，这是为什么？",
        "input": "",
        "output": "Open .shd文件的时候，记得把Recl位数从4改为1，这个是两种编译器不一样的地方，linux编译的gcc fortran为4，代表一次写入4个字(bit)，ivf（Intel Visual Fortran）就是1，代表1个字节（byte），这是根据换算关系1 btye = 4 bits得到的。"
    },
    {
        "instruction": "如何读取bellhop计算出来的单个传播损失的原始数据吗？",
        "input": "",
        "output": "可以使用read_shd函数读取声压后，直接-20log得到传播损失，请看链接 https://gitee.com/open-ocean/SourceLocalization-qianpeng/blob/master/BELLHOPQ&A/01BasicQ&A/02PltColor/readshdTL.m。"
    },
    {
        "instruction": "声学工具箱有没有现成的函数能够读取.env文件里的配置？",
        "input": "",
        "output": "使用read_env可以读取.env的配置。\n[ TitleEnv, freq, SSP, Bdry, Pos, Beam, cInt, RMax, fid ] = read_env( envfil, model );\n其中，TitleEnv为读取的.env标题，freq为频率，SSP为声速剖面结构体，Bdry为边界结构体，Pos为声源和接收器位置结构体，Beam波束结构体（仅在读取bellhop的.env时有输出信息），cInt为相速度范围结构体（仅在读取kraken的.env时有输出信息），Rmax最大计算距离（仅在读取kraken的.env时有输出信息），fid为文件句柄（该函数不会关闭文件，所以写在循环中可以能会报读到文件末尾的错误），输入参数envfil为环境文件.env的文件名（不带后缀），model为声场模型名（可以选择'KRAKEN'或者'BELLHOP'，分别代表kraken和bellhop的环境文件。"
    },
    {
        "instruction": "在声学工具箱中我想要找一个函数，要怎么知道它有没有呢？就比如这个read_env，我自己也翻找过工具箱里的说明书，但却没找到",
        "input": "",
        "output": "说明书中对函数的介绍不全。如果您已经把声学工具箱加到路径，并且已知自己想要找的函数名称，您可以直接在matlab命令行输入open {filename}，来打开该脚本。\n否则，首先要知道自己找的是什么类型的文件，比如说m文件，一般就在matlab文件夹中，然后再说功能，read_env的功能是read，在Matlab文件夹中再找read文件夹，然后就可以看到read_env.m。"
    },
    {
        "instruction": "声源位置是在环境文件里面设定的，如果我想做一个变声源深度的程序应该怎么写代码比较好，实现打开env改他的声源深度？",
        "input": "",
        "output": "有两种方式，如果您可以配合read_env和write_env两个函数，在循环中改变Pos.s.z。\nmodel = 'BELLHOP';\n[ TitleEnv, freq, SSP, Bdry, Pos, Beam, cInt, RMax, fid ] = read_env( ARRFIL, model );\nPos.s.z = {您想要的声源深度};\nwrite_env(ARRFIL, model, TitleEnv, freq, SSP, Bdry, Pos, Beam, [], RMax);\n另外，您可以仿照changeenv(f,filename)（其中f为频率，filename为环境文件名（不带后缀））改变环境文件的频率的函数，改变指定行数的声源深度，代码链接：https://gitee.com/open-ocean/SourceLocalization-qianpeng/blob/master/BELLHOPQ&A/01BasicQ&A/02PltColor/changeenv.m"
    },
    {
        "instruction": "请问下在plotarr的时候显示“输入参数的数目不足”是什么原因呢",
        "input": "",
        "output": "请确保您输入的命令为：plotarr('{filaname}.arr',1,1,1)，其中后面三个1分别代表，接收器距离索引，接收器深度索引和声源深度索引。"
    },
    {
        "instruction": "刚接触bellhop 请问下想生成传播损失图像的时候 出现了这个问题 \n>> plotshd MunkB_Coh\n错误使用 read_shd (line 125)\nUnrecognized file extension\n出错 plotshd (line 24)\n[ PlotTitle, ~, freqVec, ~, ~, Pos, pressure ] = read_shd( filename ); 该怎么解决",
        "input": "",
        "output": "plotshd后面需要加入文件后缀，请输入这个语句，plotshd( 'MunkB_Coh.shd')"
    },
    {
        "instruction": "为什么plotshd3d会显示3维的声压，但是readshd只能读出2维的",
        "input": "",
        "output": "你可以读一下readshd函数，他是一个切面一个切面读的，read_shd_bin里面读的是多个切面，有个itheta指的就是水平方向，读出来的声压也是一个四维数组。"
    },
    {
        "instruction": "在计算到达结构时，获取的信号强度，可以转换成db嘛？",
        "input": "",
        "output": "可以，获取的信号强度是Arr.A，取20log10，matlab代码为\nAdB = 20*log10(Arr.A);"
    },
    {
        "instruction": "用bellhop画声线图，声线图的纵坐标范围会随着声线变化，如果我想将他的深度范围锁定在0-5000m，请问该怎么办啊",
        "input": "",
        "output": "可以使用ylim([0 5000])语句。"
    },
    {
        "instruction": "为何使用plottlr绘制传播损失时，有些点会突变成一个固定的大值？这个问题在2023年更新的版本里还存在",
        "input": "",
        "output": "因为有些地方没有能量了，就是无穷小，画图的函数中使无穷小代替为一个较小的值。"
    },
    {
        "instruction": "bellhop3d计算的传播损失图应该如何画出来？",
        "input": "",
        "output": "使用plotshdpol可以绘制bellhop3d计算的.shd在某一接收深度上的传播损失，用法是plotshdpol( filename, xs, ys, rd )，其中xs和ys为声源的x和y坐标向量，rd为接收深度标量；您也可以使用plotshd绘制某一方向角上的传播损失，要注意的是plotshd默认画第一个水平方向角上的传播损失，若要画其他方向角，请进入plotshd.m中修改第18行中itheta的值。"
    },
    {
        "instruction": "请问怎么添加指定广义信噪比的噪声？",
        "input": "",
        "output": "下面代码为添加指定广义信噪比的噪声\n%% 固定Gama 不同的GSNR, 从而有不同的Alpha Sas 噪声\nGama=0.005;\nGSNR=-10:5:20;\nAlpha=log((y_e./10.^(GSNR/10)))./log(Gama);\n其中y_e 是 信号的能量\n参考论文Robust Deconvolution of Underwater Acoustic Channels Corrupted by Impulsive Noise\n https://ieeexplore.ieee.org/document/10050612 "
    },
    {
        "instruction": "请问大家，bellhop3d是不是无法产生.arr文件，我在bellhop3d中选择'A'模式无法生成.arr文件",
        "input": "",
        "output": "可以生成arr的，其中环境文件.env中的Runtype要用'A  3'"
    },
    {
        "instruction": "使用plotshd画出的传播损失右边的图例颜色应该如何改？",
        "input": "",
        "output": "有几种预设的颜色，jet，hot之类的，右键图例-打开颜色图编辑器，即可修改。"
    },
    {
        "instruction": "bellhop出现这样的报错怎么办\nBathymetry drops belowlowest point in the sound speed profile",
        "input": "",
        "output": "最深海深比你定义的声速剖面更深，导致他不知道下方的海水声速该取什么值，您可以检查海深和声速剖面的定义是否一致。"
    },
    {
        "instruction": "声速分布的平滑处理怎么做",
        "input": "",
        "output": "可以使用拟合处理来进行简单的平滑处理，比如使用Smoothing Spline进行简单的拟合平滑代码如下：\n\n% 定义深度和声速\nz = [0; 400; 500; 600; 700; 800; 900; 1000];\nc = [1500; 1430; 1529; 1482; 1762; 1590; 1880; 1616];\n% 对深度和声速的映射做三次样条曲线拟合，得到拟合函数f\nf = fit(z, c, 'smoothingspline', 'SmoothingParam', 0.5,'normalize','on');\nplot(f, z, c);\n% 重新定义的声速剖面深度\nssp.z = 0: 10: 1000;\n% 根据深度计算声速\nssp.c = f(ssp.z);\nhold on;\nplot(ssp.z, ssp.c, 'ro', DisplayName='拟合后结果')\n\n其中，用到了拟合函数fit，'SmoothingParam'\\in[0,1]拟合结果越平滑，而当其取值越大，拟合结果就越倾向于经过所有的点，取0.5是兼顾了平滑和数据点的影响。"
    },
    {
        "instruction": "kraken计算宽带声场后，如何读取不同频率的.shd写入的声压？并得到时域数据？",
        "input": "",
        "output": "使用read_shd_bin( 'MunkK.shd' , 50) 可以指定频率，并用for循环读取pressure，然后对频率序列做ifft得到时域数据。"
    },
    {
        "instruction": "请问一下C#或者c++如何通过代码直接调用bellhop而不是通过读写.env和.shd的方式调用？即通过变量传递的方式调用bellhop计算声场服务？",
        "input": "",
        "output": "需要写一个传参的interface来调用bellhop的fortran源码，在内存里面将c#或者c++的声场变量以bellhop fortran源码的数据结构传入bellhop计算声场。"
    },
    {
        "instruction": "影响bellhop计算的速度有哪些？",
        "input": "",
        "output": "1.文件读写，通过.env读写和.shd等写入磁盘文件I/O的方式导致计算速度受到影响。2.bellhop fortran源码使用了全局变量，导致无法在内部分声线并行，计算使用的资源受限导致计算较慢。"
    },
    {
        "instruction": ".shd绘图的结果分辨力不够怎么办？",
        "input": "",
        "output": "接收器的水平或者竖直分割网格数太小，可以适当的设置密集一些，比如说接收器距离网格0.1km一个，接收器深度网格10m一个。"
    },
    {
        "instruction": "请问一下kraken可以直接生成声压数据用mat文件保存，那么bellhop的声压数据也可以用mat保存吗，怎么保存？",
        "input": "",
        "output": "请看这个函数： https://gitee.com/open-ocean/SourceLocalization-qianpeng/blob/master/BELLHOPQ&A/01BasicQ&A/02PltColor/shd2mat.m"
    },
    {
        "instruction": "怎么能让kraken计算完之后不在命令行打印信息？",
        "input": "",
        "output": "在kraken源码中把write(*,*)开头的代码注释或者删除，重新编译即可。write(*,*)是fortran中向屏幕输出信息的代码，删除后，不会在命令行打印信息。"
    },
    {
        "instruction": "bellhop计算的pressure为什么是double不是complex类型呢",
        "input": "",
        "output": "如果Runtype使用'I'模式（非相干模式），算出来声压没有相位，可以改为'C'模式（相干模式），算出来声压是复数，为complex类型。"
    },
    {
        "instruction": "加入.trc报错*** FATAL ERROR ***\nGenerated by program or subroutine:KRAKENC\nNo modes for given phase speed interval是为什么？",
        "input": "",
        "output": "您给出的报错信息上说，“在给定相速度区间内没有模式”，也许您可以增大相速度的计算范围。"
    },
    {
        "instruction": "bellhop3d里的ssp写出来顺时针转了90度，该怎么解决？",
        "input": "",
        "output": "可以读取ssp中的矩阵，然后使用flip函数对矩阵进行旋转，得到正确的ssp矩阵。"
    },
    {
        "instruction": "运行kraken时报这个错是为什么，Could not print backtrace: libbacktrace could not find executable to open，之前只有一个接收的时候没报错，水平方向上加了几个接收就这样了",
        "input": "",
        "output": "出现这个问题的可能原因是写入接收位置的首末位置后面没加斜杠，写左值右值然后斜杠是自动填充的意思，如果不加入'/'的话，可能会读取不到数据。"
    },
    {
        "instruction": "Bellhop环境文件是不是只能设置矩形布阵的接收阵列，不能设置成三角形状的接收节点阵列？",
        "input": "",
        "output": ".env有不规则网格的选项，将runtype第五个字符改为'I'，可以对每个接收器的距离和深度单独设置。"
    },
    {
        "instruction": "请问能否在plotarr时显示声线的类型，就像plotray那样，用不同颜色区分直达、碰界面的声线？",
        "input": "",
        "output": "可以的，请看这个代码，调用方式与plotarr一致plotarrTB( filename, irr, ird, isd )，网址：https://gitee.com/open-ocean/Underwater-Target-Recognition/blob/master/Utility/AcousticTools/Matlab/plot/plotarrTB.m"
    },
    {
        "instruction": "bellhop环境文件.env顶部参数（Top option）为'NVM~'，这个'~'和'*'是不是等价的？",
        "input": "",
        "output": "是的，'~'是老版本的定义，'*'是新版本的定义，两者是等价的，都代表读海面形状.ati文件。"
    },
    {
        "instruction": "使用kraken设置水平变化设置多个剖面，分隔每个剖面的水平距离是只需要在flp中修改吗？",
        "input": "",
        "output": "分隔每个剖面的水平距离是只需要在flp，如果rprof设为0，8，11的话，nprof应该是3。也就是kraken中计算时，第一个剖面起点为0，第二个剖面起点为4（要(0+8)/2），因此要完成0 8的两个剖面，RPROF的书写格式应该是\n2/\n0  16/"
    },
    {
        "instruction": "请问Generated by program or subroutine: BELLHOP:ReadBTY\nBathymetry drops below lowest point in the sound speed profile\n报这个错应该怎么解决？",
        "input": "",
        "output": "出现这个问题的可能原因是，.bty定义的海底地形深度大于了.env中声速剖面ssp定义的深度，因此可以通过外插方法对ssp进行插值，.env的ssp的定义深度大于海底地形深度。"
    },
    {
        "instruction": "bellhop海底地形文件（.bty）怎么写？",
        "input": "",
        "output": "Bellhop地形自己新建一个同名txt文件，写好地形之后把文件后缀名修改为 .bty，您可以参考这个视频【01ETOPO1数据写入bty】 https://www.bilibili.com/video/BV1wu4y1J7MV/?share_source=copy_web&vd_source=da3bd6e68ced42ab3b6a4778db8cb6d2 ，代码在视频简介。"
    },
    {
        "instruction": "为什么kraken环境env文件里海底横波速度设置不为0的话，程序就会报错呢？报错信息：\n错误使用 interp1>reshapeAndSortXandV(line 417)X 必须为向量。\n出错interpl(line 93)IX, V,orig_size_v]= reshapeAndSortXandV(varargin{1}, varargin{2});\n出错 field(line 70)C=interpl( Modes.z,Modes.phi, Pos.s.z);\n出错 kraken(line 23)field( filename );",
        "input": "",
        "output": "使用krakenc计算海底横波条件下的海洋声场更为使用，由于kraken和krakenc的环境文件形式完全一致，因此您需要把代码修改为krakenc filename；另外，上面报错信息是由于使用了matlab版本的field，您可能需要使用用fortran版本的，打开krakenc.m，把matlab版本（field(filename)）的注释掉，把fortran版本的（field.exe）取消注释。"
    },
    {
        "instruction": "read_arrivals_asc这个函数读到的多途到达时延和到达角，能按直达波和海面或海底一次反射区分开？",
        "input": "",
        "output": "read_arrivals_asc读取出来Arr结构体后，结构体有NumTopBnc NumBotBnc的参数，根据这两个参数可以按直达波和海面或海底一次反射区分开，具体的代码为\nindexTNC0BNC0 = Arr.NumTopBnc==0 &Arr.NumBotBnc==0; % 直达\nindexTNC1BNC0 = Arr.NumTopBnc~=0 &Arr.NumBotBnc==0; % 海面反射\nindexTNC0BNC1 = Arr.NumTopBnc==0 &Arr.NumBotBnc~=0; % 海底反射\nindexTNC1BNC1 = Arr.NumTopBnc~=0 &Arr.NumBotBnc~=0; % 海面、海底反射"
    },
    {
        "instruction": "BELLHOP环境文件转换为.in文件，但是运行RAM之后得到的生涯数据一直是空的，这是为什么呢？",
        "input": "",
        "output": "有可能是ndz太大了导致的，ndz决定了间隔多少个深度网格dz输出pressure，如果ndz*dz>最大输出深度zmplt了，所以只做了计算，没输出pressure，或者把zmplt改大点也可以。"
    },
    {
        "instruction": "为什么从官网直接下的ram是没有输入参数的，那要怎么使用它？",
        "input": "",
        "output": "官方版只支持输入文件名是ram.in，其他文件名都不行，且ram.in的路径默认与exe一样的路径；您也可以去ram源码里面，把固定的ram.in改成主函数入参的形式，ram_p就是这样改的。。"
    },
    {
        "instruction": "某个深度下传播损耗的曲线是怎么看？",
        "input": "",
        "output": "使用plottld绘制.shd的距离的传播损失，调用方式：plottld(filename, rr)，其中filename是声压文件(.shd例如MunkK.shd)，rr指定某个距离"
    },
    {
        "instruction": "运行RAM的时候没有报错，但是最后结果读出来的pressure值从某一距离后就全是非数值结果NaN，怎么改",
        "input": "",
        "output": "有可能是环境问题，RAM并不像kraken那么完备，不能在任何情况下都给出你准确的错误信息，试一下把ns改为1，绝大多数取1或2就可以。"
    },
    {
        "instruction": ".env环境文件用krakenc跑，当频率设为1999或者2001时都可以正常运行，但是频率设为2000时就会报错，怎么解决？",
        "input": "",
        "output": "如果环境文件.env格式没有问题，可以试着用fortran版本field.exe更加稳定的运行，具体操作是ctrl+d打开krakenc.m，把matlab版本的注释掉，fortran版本的取消注释，改完后重新使用krakenc运行声场。"
    },
    {
        "instruction": "请问出现了这个问题应该怎么解决，Terminating the rayiracebecause the source is on or outside the boundaries",
        "input": "",
        "output": "声源放到边界外面了（可能放到了地形里面），bellhop只能把声源放到水体当中，打开.env文件，检查Sz的深度是否在海面下、海底上。"
    },
    {
        "instruction": "下载的一个计算传播损失的模型，编译makefile的时候会提示错误，make :Yo rule to make targetmoatl.o', needed by 'moatl.out' Stop.",
        "input": "",
        "output": "可能是没有权限，可以试着使用sodu make提供管理员权限。"
    },
    {
        "instruction": "bellhop可以得到多径中各条路径的功率吗",
        "input": "",
        "output": "把arr里的幅度A转换成分贝级就是每条路径的功率，即20log10(abs(A))。"
    },
    {
        "instruction": "用bellhop做大量计算的时候有没有遇到过报错“现在无法访问以前可访问的文件”",
        "input": "",
        "output": "有可能是打开文件后没有关闭，可以在每个bellhop运行之后加一个fclose all试试，如果对原来程序没有影响的话；或者关了matlab再启matlab跑试试。"
    },
    {
        "instruction": "运行kraken报错应该如何解决？\n*** FATAL ERROR ***\nGenerated by program or subroutine: ReadEnvironmentMesh is too coarse",
        "input": "",
        "output": "kraken报错 ReadEnvironmentMesh is too coarse，说明环境网格太粗，需要调整网格精度。可以通过修改kraken的输入文件，调整网格精度参数，例如修改网格步长、网格密度等，以提高网格精度。\n例如MunkK.env\n'BBMunk profile\n50\n1\n'NVW'\n1  0.0  5000.0\n0.0  1548.52  0.0  1.0  0.0  0.0\n应改为BBMunk profile\n50\n1\n'NVW'\n0  0.0  5000.0\n0.0  1548.52  0.0  1.0  0.0  0.0"
    },
    {
        "instruction": "请问我运行kraken，得到的不是.shd文件，而是.shd.mat文件，这是为什么？",
        "input": "",
        "output": "2020-11版本的声学工具箱中，kraken默认用的是matlab版本的field.m函数，生成的声场为.shd.mat格式的声压，可以用plotshd绘制传播损失，代码示例\nplotshd MunkK.shd.mat。或者您可以打开kraken.m，把matlab版本的注释掉，fortran版本的取消注释，使用fortran版本的field生成的文件为.shd后缀。"
    },
    {
        "instruction": "请问一下，如果我想要设置掠射角范围为0~89°，间隔1°，间隔可以在.env文件里设置吗，该怎么设置呢？",
        "input": "",
        "output": "如果要在bellhop的env中设置略射角范围和间隔，可以直接设定范围和角度个数，根据您的要求，计算出角度个数为90，因此设定角度为\n90 ! NBEAMS\n0 89 /! ALPHA1, 2 (degrees)"
    },
    {
        "instruction": "bellhop计算时，水平距离由100km设置成200km，使用plotshd画图后显示100km后面没有数据是为什么",
        "input": "",
        "output": "可能的原因是环境文件中rbox设置太小，按照您计算的水平距离200km，rbox应该大于最大的计算水平距离，比如说设置为205。"
    },
    {
        "instruction": "bellhop运行声场时，不同频率不同海洋深度条件下，怎么去估计大致的声线数？",
        "input": "",
        "output": "bellhop的计算声线数与频率、海深、最远的接收器距离均有关系，如果环境文件.env中声线数NBeams设置为0，程序自动计算声线数，fortran源代码为Angles%Nalpha =MAX( INT(0.3 * Pos%Rr( Pos%NRr )* freq/c0 ),300)\nd theta recommended=ATAN(Depth/ 10.0 *Pos%Rr( Pos%NRr )))\nAngles%Nalpha =MAX( INT( pi /d theta recommended ), Angles%Nalpha)\n"
    },
    {
        "instruction": "运行bellhop3d模型的时候，env文件没有改变，只是换了一个区域，只改变了ssp和bty文件，就会出现报错，这是什么原因呢？错误： *** FATAL ERROR ***\n Generated by program or subroutine: Hexahedral ray is outside the box where the soundspeed is defined",
        "input": "",
        "output": "尽可能将.ssp的首尾距离设置大一些，比如设定为声速范围为-RBox-1 RBox+1以超过声线计算的距离范围。"
    },
    {
        "instruction": "使用plotray画声线图中的红色线代表什么呢，黑色线又是代表什么意思呢",
        "input": "",
        "output": "红色线代表不碰上下边界的直达声线，绿色线代表只碰上边界的海面反射声线，蓝色线代表只碰下边界的海底反射声线，黑色代表触碰上下边界的海底海面（不分顺序）反射声线。"
    },
    {
        "instruction": "ubuntu下编译声学工具箱后，生成的exe文件如何调用？",
        "input": "",
        "output": "转到声学工具箱路径后，在命令行输入\nmkdir bin\nmake install\n在bin路径下即可看到编译生成后的bellhop.exe，如果想调用bellhop.exe，可以将tests/Munk/路径下的测试环境文件MunkB_Coh.env拷贝到与bellhop.exe相同路径下，并在命令行输入./bellhop.exe MunkB_Coh，如果生成MunkB_Coh.prt、MunkB_Coh.shd文件，则调用bellhop.exe计算声场成功。"
    },
    {
        "instruction": "在用Bellhop3D绘制声传播损失的时候，报错“ ray is outside the box where the soundspeed is defined”",
        "input": "",
        "output": "可能是提取数据的区域不够广，射线计算的范围超过了三维.ssp声速定义的范围，可以增加.ssp的定义x y z的范围。"
    },
    {
        "instruction": "请问我运行bellhop后不生成ray文件是为什么？",
        "input": "",
        "output": "生成不了.ray文件有很多原因，其中可能是runtype没有改为'R'\n，例如将MunkB_Coh.env中41行，\n'CG'       ! 'R/C/I/S'\n0     ! NBEAMS-20.3 20.3 /     ! ALPHA1, 2 (degrees)\n50.0  5500.0  101.0 !  STEP (m), ZBOX (m), RBOX (km)\n改为：\n'RG'       ! 'R/C/I/S'\n0     ! NBEAMS-20.3 20.3 /     ! ALPHA1, 2 (degrees)\n50.0  5500.0  101.0 !  STEP (m), ZBOX (m), RBOX (km)\n"
    },
    {
        "instruction": "我想问下在matlab工具栏设置路径并添加文件夹和 运行声学工具箱at_init.m设置路径的作用和区别是什么？",
        "input": "",
        "output": "两种方法添加路径是相同的功能。这个步骤的涵义是将声学工具箱添加到matlab的搜索路径上，方便调用声学工具箱的函数的可执行文件。"
    },
    {
        "instruction": "想看kraken 相干或者非相干的模式的TL结果，该在flp里如何设置？为啥只给出了option(1,2,4)的设置，option(3)如何设置？",
        "input": "",
        "output": "option(3)一般不用设置，可以直接使用空格，跳到第四个位置，即设置'RA C'，其中'R'代表点声源，'A'代表绝热模式，'C'代表相干叠加声场。"
    },
    {
        "instruction": "把kraken 模式个数设为1 再运行kraken，并plotshd ，是看的它基频的传播损失么？",
        "input": "",
        "output": "不是基频，而是第一个简正波模式数的损失，如果要看一个频率的传播损失的话，把模式个数设置足够多，比如9999，然后运行kraken，plotshd就可以，因为单个频率的声压是多个简正波模式的和。"
    },
    {
        "instruction": ".bty的参数是怎么设置的？如何写.bty文件？",
        "input": "",
        "output": "地形文件可以手动编写,也可以用write_bty.m程序写人,比如我们简单地手写一个,新建一个txt文档或者写字板文档,编入以下地形信息:\n'L'\n5\n20 3000\n30 2000\n35 2000\n40 2500\n50 3000\n其中,“L”为插值类型,表示线性插值;“5”为距离参数个数,剩下的为5x2的矩阵,第一列代表距离)单位:km),第二列为对应距离上的深度(单位:m)。编辑好后,保存为*.bty文件即可，文件名要与环境文件一样，对应上例为Bellhop_data.bty；使用write_bty.m函数把地形写入.bty文件，代码为\nwrite_bty(envfil, interp_type, bath); \n其中envfil为写入的文件名（不需要加后缀），interp_type为插值类型（比如设置为'L'，表示线性插值），bath为地形结构体，包括bath.range距离向量（单位km）和深度bath.depth深度向量（单位m），代码链接 https://gitee.com/open-ocean/SourceLocalization-qianpeng/blob/master/BELLHOPQ&A/02DataSetInteraction/01BELLHOP_ETOPO1/write_bty.m"
    },
    {
        "instruction": "使用plotssp请问画声速剖面时，能去掉线上的圆圈吗",
        "input": "",
        "output": "使用图框中的光标按钮，然后选中圆圈，右击删除就可以了。"
    },
    {
        "instruction": "声学工具箱里有读取.ray文件的函数吗？",
        "input": "",
        "output": "声学工具箱中没有单独的读取.ray文件的函数，但是使用plotray可以绘制.ray文件的声线轨迹，里面包含了读取.ray文件的相关代码，如果您已经把声学工具箱的路径放在matlab路径中，您可以在matlab命令行中输入\nopen plotray\n来打开plotray.m，或者是在matlab命令行或者脚本中输入plotray，并使用ctrl+d快捷键打开这个函数。"
    },
    {
        "instruction": "环境文件中海底参数行各个参数是什么涵义？对传播损失有什么影响？",
        "input": "",
        "output": "海底参数的六个参数分别代表：\n 5000.0  1600.00 0.0 1.8 0.8 /\n深度 纵波声速 横波声速 密度 纵波衰减系数 横波衰减系数\n海底参数一般影响碰到海底的声线的能量、相位，在深海中，影响着海底反弹区的声能量和相位；在浅海中，由于声线很容易碰到海底，对整个区域内的声能量和相位有着较大程度的影响。"
    },
    {
        "instruction": "用声呐探测目标时，如果知道目标位于海域中的某一深度和距离，用bellhop计算得到传播损失得到tlt, 对应目标位置处的传播损失应该如何获得？",
        "input": "",
        "output": "tlt是根据.shd中读取的声压pressure得到的，其维度也和pressure相同，pressure默认为4个维度，Ntheta*NSd*Nrd*Nrr（水平方向角*声源深度*接收器深度*接收器距离），如果知道目标的深度和距离，根据距离和深度信息即可确定目标所在tlt的索引。"
    },
    {
        "instruction": "Bellhop 环境文件中声线开角alpha1、2分别指的是从声源出发声线的水平和垂直方向的开角吗？那alpha1、2的物理意义？",
        "input": "",
        "output": "Bellhop 环境文件中声线开角alpha1、2分别指的是从声源出发声线竖直方向的开角（俯仰角），在实际情况中，指的是声源的竖直方向的波束角范围，其单位为度，竖直向下为正，水平方向为0°。水平角范围则是Bellhop3d 环境文件中声线开角beta1和beta2。"
    },
    {
        "instruction": "声传播损失图里面可以看汇聚区吗?",
        "input": "",
        "output": "可以使用plotshd看到汇聚区的二维分布，声线汇聚区声能量强，颜色越红，暖色调汇聚的区域即为汇聚区。也可以使用plottlr和plottld查看汇聚区在距离和深度上的一维分布，根据一维分布确定汇聚区的距离和深度范围。"
    },
    {
        "instruction": "为什么在非均匀环境下用field.m函数和用field.exe本身跑出来的结果不一样呢？",
        "input": "",
        "output": "field.exe是用fortran语言编译的可执行性文件，而直接调用feild.m则调用的是matlab版本的代码，其中fortran版本的field.exe要比matlab的feild.m代码功能更全，feild.m不支持计算非均匀条件下的声场，因此非均匀环境下用field.m函数和用field.exe本身跑出来的结果不一样。"
    },
    {
        "instruction": "kraken计算时为什么要.mod文件呢 .mod不是kraken的输出文件是吗？",
        "input": "",
        "output": ".mod既是kraken.m的输出文件，又是输入文件。在Matlab中调用kraken.m实际上是调用了kraken.exe和field.exe，kraken.exe的输入是.env，输出的是.mod和.prt，field.exe输入.mod和.flp，输出是.shd。"
    },
    {
        "instruction": "bellhop里面，声源和接收器的距离在环境文件中是哪个参数决定呢？",
        "input": "",
        "output": "声源是SD，水平接收器距离是R和NR决定的，垂直是RD和NRD，声源的默认距离为0km。"
    },
    {
        "instruction": "ram的环境文件中rb zb zmax应该如何理解？c0是取深度为0时点的声速吗？",
        "input": "",
        "output": "zb是地形的描述，比如\n0 800\n4000 400\n，指的是0-4000米处深800m的平坦海底；如果是\n0 800\n4000 400\n则理解为，0米处800米深，4000m处深400米的上坡海底，zmax是计算深度网格的最大深度；c0是参考声速。"
    },
    {
        "instruction": "用RAM计算出来的脉冲响应和Bellhop计算出来的结果多径和幅度都是一样的，但是RAM会有一大段时延在前面，这是什么原因？",
        "input": "",
        "output": "由于宽带傅里叶合成方法具有傅里叶的周期性，因此计算结果可能与bellhop的时延对不上，可以计算出接收器位置处的大概时延，并对RAM的输出结果做时延处理，pres_t = df *2* real(ifft(pres.*(ones(M,1)* exp(1j*tmin*2*pi*f0)),[],2)); 也可以在傅里叶合成时加入时延tmin。"
    },
    {
        "instruction": "bellhop生成的信道一般怎么进行归一化？",
        "input": "",
        "output": "可以按照最大幅度归一化，即把生成的Arr的幅度都除以Arr的最大幅度，代码为：\nArr.A = Arr.A/max(Arr.A);"
    },
    {
        "instruction": "在绘制声到达结构的时候，有办法绘制对应的那条幅度最大值的声线吗",
        "input": "",
        "output": "可以的，一般是这样处理的，改变.env环境文件的runtype，使用本征声线模式'A'，使用plotarrTB用不同颜色区分直达、碰界面的到达结构，改变.env环境文件的runtype，使用本征声线模式'E'，使用plotray.m画声线，根据颜色得到幅度最大值的声线，一般红色（直达声线）的幅度最大。网址： https://gitee.com/open-ocean/Underwater-Target-Recognition/blob/master/Utility/AcousticTools/Matlab/plot/plotarrTB.m 然后根据arr中的出射角度信息，判断声线图中的哪个声线是幅度最大值的声线。"
    },
    {
        "instruction": "使用krakenc计算声场，需要补充phi和k文件么？",
        "input": "",
        "output": "不用，他和kraken用法是完全一样的，环境文件也完全一致，只需要把kraken(filename)改为krakenc(filename)。"
    },
    {
        "instruction": "kraken算出来的结果k随着n的变大在变小，kraken计算出k是水平波数嘛",
        "input": "",
        "output": "是的，kraken计算出.mod文件，然后使用[ Modes ] = read_modes_asc( filename, modes )读取Modes模式结构体，Modes.k代表的是水平波数。"
    },
    {
        "instruction": "bellhop 总是提示我超出范围报错，应该如何解决",
        "input": "",
        "output": "尽可能将.ssp的首尾距离设置大一些，比如设定为声速范围为-RBox-1 RBox+1以超过声线计算的距离范围。"
    },
    {
        "instruction": "bellhop中出射角范围设置的依据是什么，比如想模拟爆炸声源或者舰船噪声，是不是应该设置为（-90°，0°）呢",
        "input": "",
        "output": "这个设置角度取决于声源的指向性，如果没有指向性，就是全波束,即-90 90，是全波束。"
    }
]